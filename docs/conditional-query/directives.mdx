---
title: Directives
description: Learn how to use directives in conditional queries to change the behavior of the query in ReductStore.
---

<head>
  <link
    rel="canonical"
    href="https://www.reduct.store/docs/conditional-query/directives"
  />
</head>

# Directives

**[Directives](../glossary#directive)** are special instructions in conditional queries that modify how the query engine processes results.
They are prefixed with `#` and can be used to control aspects such as including additional records before or after those that match a given condition.

The following directives are supported:

| Directive              | ReductStore Version | Description                                                                                    |
| ---------------------- | ------------------- | ---------------------------------------------------------------------------------------------- |
| **Querying**            |                     |
| `#ctx_before`          | v1.16               | Add additional records before each matching record as context, either by count or time window. |
| `#ctx_after`           | v1.16               | Add additional records after each matching record as context, either by count or time window.  |
| `#select_labels`       | v1.16               | Retain only the specified labels in a record after filtering.                                  |
| **Extension**          |                     |                                                                                                |
| `#ext`                 | v1.17               | Contains query parameters for extensions that process data during querying.                    |
| **Communication**      |                     |                                                                                                |
| `#batch_size`          | v1.17               | Maximum size of a batch of records returned by the query.                                      |
| `#batch_records`       | v1.17               | Maximum number of records in a batch returned by the query.                                    |
| `#batch_metadata_size` | v1.17               | Maximum size of metadata in a batch returned by the query.                                     |
| `#batch_timeout`       | v1.17               | Maximum time to wait before sending a batch of records.                                        |
| `#record_timeout`      | v1.17               | Maximum time to wait for a record to be processed before sending a batch.                      |
| `#io_timeout`          | v1.17               | Maximum time to wait for I/O operations during querying. Reserved for future use.              |

## `#ctx_before`

The `#ctx_before` directive allows you to include extra records that occurred **before** each matching record.
This is useful when you want context around a matched condition, such as to see what led up to it.

### Syntax

```
{
  "#ctx_before": <expression as int> | <duration literal>
}
```

### Behavior

- If the expression is an **integer**, it is interpreted as the number of records to include before each match.
- If the expression is a **duration literal** (e.g. `"1s"`, `"10m"`, `"500ms"`), it is interpreted as a time window to include records within that period before each match.

### Examples

By number of records:

```json
{
  "#ctx_before": 10
}
```

By time duration:

```json
{
  "#ctx_before": "1h"
}
```

## `#ctx_after`

The `#ctx_after` directive allows you to include extra records that occur **after** each matching record.
This is useful when you want to examine consequences or outcomes following a detected condition.

### Syntax

```
{
  "#ctx_after": <expression as int> | <duration literal>
}
```

### Behavior

- If the expression is an **integer**, it is interpreted as the number of records to include after each match.
- If the expression is a **duration literal**, it is interpreted as a time window to include records within that period after each match.

### Examples

By number of records:

```json
{
  "#ctx_after": 5
}
```

By time duration:

```json
{
  "#ctx_after": "30s"
}
```

## `#select_labels`

The `#select_labels` directive allows you to filter the labels retained in each record after applying the query.

### Syntax

```
{
  "#select_labels": [<label name 1>, <label name 2>, ...]
}
```

### Behavior

This directive is applied after all other query processing, including context inclusion and filtering.

:::info
The `#select_labels` directive is ignored in replication conditional queries.
:::

### Example

```json
{
  "#select_labels": ["temperature", "humidity"]
}
```

## `#ext`

The `#ext` directive is used to specify parameters for **[extensions](../../glossary#extension)** that process data during querying.

### Syntax

```
{
  "#ext": {
    "<extension_name>": { <extension_parameters> }
  }
}
```

### Behavior

The `#ext` directive allows you to pass configuration options to an extension that will process the data as part of the query.
The specific parameters depend on the extension being used. Read more about the official extensions in the [**Extensions Documentation**](../extensions/).

:::info
The `#ext` directive is ignored in replication conditional queries.
:::

### Example

```json
{
  "#ext": {
    "select": {
      "columns": [{ "index": 0, "as_label": "speed" }]
    }
  }
}
```

## `#batch_size`

The `#batch_size` directive sets the maximum size (in bytes) of a batch of records returned by the query.

### Syntax

```
{
  "#batch_size": <expression as int | string>
}
```

If the expression is a **string**, it can include size suffixes like `KB`, `MB`, or `GB` (e.g. `"10MB"`).

### Behavior

The querying stops when the batch size is reached but puts the current record in the batch, even if it exceeds the limit.
It means that the actual batch size may be larger than the specified limit.

This directive overrides the server's `RS_IO_BATCH_MAX_SIZE` setting. See the [**server configuration documentation**](../configuration.mdx#io-settings) for more details.

### Example

```json
{
  "#batch_size": "5MB"
}
```

## `#batch_records`

The `#batch_records` directive sets the maximum number of records in a batch returned by the query.

### Syntax

```
{
  "#batch_records": <expression as int>
}
```

### Behavior

The querying stops when the number of records in the batch reaches the specified limit.

This directive overrides the server's `RS_IO_BATCH_MAX_RECORDS` setting. See the [**server configuration documentation**](../configuration.mdx#io-settings) for more details.

### Example

```json
{
  "#batch_records": 1000
}
```

## `#batch_metadata_size`

The `#batch_metadata_size` directive sets the maximum size (in bytes) of metadata in a batch returned by the query.

### Syntax

```
{
  "#batch_metadata_size": <expression as int | string>
}
```

If the expression is a **string**, it can include size suffixes like `KB`, `MB`, or `GB` (e.g. `"1MB"`).

### Behavior

The querying stops when the metadata size in the batch reaches the specified limit but puts the current record in the batch, even if it exceeds the limit.
It means that the actual metadata size may be larger than the specified limit.

This directive overrides the server's `RS_IO_BATCH_MAX_METADATA_SIZE` setting. See the [**server configuration documentation**](../configuration.mdx#io-settings) for more details.

### Example

```json
{
  "#batch_metadata_size": "500KB"
}
```

## `#batch_timeout`

The `#batch_timeout` directive sets the maximum time to wait before sending a batch of records.

### Syntax

```
{
  "#batch_timeout": <expression as duration literal>
}
```

### Behavior

The querying sends the current batch when the timeout is reached, even if the batch is not full.

This directive overrides the server's `RS_IO_BATCH_TIMEOUT` setting. See the [**server configuration documentation**](../configuration.mdx#io-settings) for more details.

### Example

```json
{
  "#batch_timeout": "200ms"
}
```

::info
The `#batch_timeout` directive is ignored in replication conditional queries.
:::

## `#record_timeout`

The `#record_timeout` directive sets the maximum time to wait for a record to be processed before sending a batch.

### Syntax

```
{
  "#record_timeout": <expression as duration literal>
}
```

### Behavior

The querying sends the current batch when the timeout is reached, even if the current record is not fully processed.

This directive overrides the server's `RS_IO_BATCH_RECORD_TIMEOUT` setting. See the [**server configuration documentation**](../configuration.mdx#io-settings) for more details.

### Example

```json
{
  "#record_timeout": "100ms"
}
```

:::info
The `#record_timeout` directive is ignored in replication conditional queries.
:::

## `#io_timeout`

The `#io_timeout` directive sets the maximum time to wait for I/O operations during querying.

### Syntax

```
{
  "#io_timeout": <expression as duration literal>
}
```

### Behavior

The querying aborts if an I/O operation takes longer than the specified timeout.

:::info
This directive is reserved for future use and currently has no effect.
:::

### Example

```json
{
  "#io_timeout": "5s"
}
```
